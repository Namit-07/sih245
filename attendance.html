<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - Automated Attendance System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .tab-active {
            border-bottom: 3px solid #4f46e5;
            color: #4f46e5;
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <svg class="h-8 w-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span class="ml-2 text-xl font-semibold">Teacher Dashboard</span>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">Welcome, Ms. Priya Sharma</span>
                    <button onclick="logout()"
                        class="bg-red-500 text-white px-4 py-2 rounded-lg text-sm hover:bg-red-600">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Tabs -->
        <div class="border-b border-gray-200 mb-8">
            <nav class="-mb-px flex space-x-8">
                <button onclick="switchTab('profile')" id="profileTab"
                    class="tab-active py-2 px-1 border-b-2 font-medium text-sm">
                    My Profile
                </button>
                <button onclick="switchTab('attendance')" id="attendanceTab"
                    class="py-2 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700">
                    Mark Attendance
                </button>
                <button onclick="switchTab('reports')" id="reportsTab"
                    class="py-2 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700">
                    Reports
                </button>
                <button onclick="switchTab('students')" id="studentsTab"
                    class="py-2 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700">
                    Manage Students
                </button>
            </nav>
        </div>

        <!-- Profile Tab Content -->
        <div id="profileContent" class="tab-content">
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6">Teacher Information</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm text-gray-600">Full Name</p>
                            <p class="text-lg font-semibold">Ms. Priya Sharma</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Employee ID</p>
                            <p class="text-lg font-semibold">TCH2024001</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Email</p>
                            <p class="text-lg font-semibold">teacher@demo.com</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Phone</p>
                            <p class="text-lg font-semibold">+91 9876543210</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <p class="text-sm text-gray-600">School</p>
                            <p class="text-lg font-semibold">Government Primary School, Rajpur</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Subjects Teaching</p>
                            <p class="text-lg font-semibold">Mathematics, Science</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Classes Assigned</p>
                            <p class="text-lg font-semibold">Class 5-A, Class 6-B</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Join Date</p>
                            <p class="text-lg font-semibold">15 July 2020</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <p class="text-sm text-blue-600">Total Students</p>
                        <p class="text-2xl font-bold text-blue-800">65</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p class="text-sm text-green-600">Today's Attendance</p>
                        <p class="text-2xl font-bold text-green-800">92%</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <p class="text-sm text-purple-600">Classes Today</p>
                        <p class="text-2xl font-bold text-purple-800">4</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Attendance Tab Content -->
        <div id="attendanceContent" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Mark Attendance</h2>
                    <div class="flex items-center space-x-4">
                        <select id="classSelect" class="border border-gray-300 rounded-lg px-4 py-2">
                            <option>Class 5-A</option>
                            <option>Class 6-B</option>
                        </select>
                        <input type="date" id="attendanceDate" class="border border-gray-300 rounded-lg px-4 py-2">
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="mb-4 flex space-x-2">
                    <button onclick="markAllPresent()"
                        class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">
                        Mark All Present
                    </button>
                    <button onclick="markAllAbsent()"
                        class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                        Mark All Absent
                    </button>
                    <button onclick="resetAttendance()"
                        class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
                        Reset
                    </button>
                </div>

                <!-- Student List -->
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Roll No</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Student Name</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Status</th>
                                <th
                                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Remarks</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200" id="studentList">
                            <!-- Students will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Submit Button -->
                <div class="mt-6 flex justify-end">
                    <button onclick="submitAttendance()"
                        class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 font-semibold">
                        Submit Attendance
                    </button>
                </div>
            </div>
        </div>

        <!-- Reports Tab Content -->
        <div id="reportsContent" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6">Attendance Reports</h2>

                <!-- Report Filters -->
                <div class="mb-6 flex flex-wrap gap-4">
                    <select class="border border-gray-300 rounded-lg px-4 py-2">
                        <option>Select Class</option>
                        <option>Class 5-A</option>
                        <option>Class 6-B</option>
                    </select>
                    <select class="border border-gray-300 rounded-lg px-4 py-2">
                        <option>Report Type</option>
                        <option>Daily</option>
                        <option>Weekly</option>
                        <option>Monthly</option>
                    </select>
                    <input type="date" class="border border-gray-300 rounded-lg px-4 py-2" placeholder="From Date">
                    <input type="date" class="border border-gray-300 rounded-lg px-4 py-2" placeholder="To Date">
                    <button class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700">
                        Generate Report
                    </button>
                </div>

                <!-- Manage Students Tab Content -->
                <div id="studentsContent" class="tab-content hidden">
                    <div class="bg-white rounded-lg shadow-lg p-8">
                        <h2 class="text-2xl font-bold mb-6">Manage Students</h2>

                        <!-- Add Student Form -->
                        <form id="addStudentForm" class="grid md:grid-cols-4 gap-4 mb-6">
                            <input type="number" id="roll" placeholder="Roll No" class="border rounded px-3 py-2"
                                required>
                            <input type="text" id="name" placeholder="Student Name" class="border rounded px-3 py-2"
                                required>
                            <input type="text" id="className" placeholder="Class (e.g. Class 5-A)"
                                class="border rounded px-3 py-2" required>
                            <button type="submit"
                                class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">
                                Add Student
                            </button>
                        </form>

                        <!-- Student List -->
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Roll
                                            No</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Name
                                        </th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                            Class</th>
                                    </tr>
                                </thead>
                                <tbody id="studentManageList" class="bg-white divide-y divide-gray-200">
                                    <!-- Fetched students will render here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


                <!-- Summary Cards -->
                <div class="grid md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <p class="text-sm text-blue-600">Average Attendance</p>
                        <p class="text-2xl font-bold text-blue-800">87.5%</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p class="text-sm text-green-600">Perfect Attendance</p>
                        <p class="text-2xl font-bold text-green-800">12</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <p class="text-sm text-yellow-600">Below 75%</p>
                        <p class="text-2xl font-bold text-yellow-800">5</p>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg">
                        <p class="text-sm text-red-600">Chronic Absence</p>
                        <p class="text-2xl font-bold text-red-800">2</p>
                    </div>
                </div>

                <!-- Recent Reports -->
                <h3 class="text-lg font-semibold mb-4">Recent Reports</h3>
                <div class="space-y-3">
                    <div class="border border-gray-200 rounded-lg p-4 flex justify-between items-center">
                        <div>
                            <p class="font-semibold">Class 5-A - Monthly Report</p>
                            <p class="text-sm text-gray-600">Generated on: 01 Sept 2025</p>
                        </div>
                        <button class="text-indigo-600 hover:text-indigo-800">Download PDF</button>
                    </div>
                    <div class="border border-gray-200 rounded-lg p-4 flex justify-between items-center">
                        <div>
                            <p class="font-semibold">Class 6-B - Weekly Report</p>
                            <p class="text-sm text-gray-600">Generated on: 30 Aug 2025</p>
                        </div>
                        <button class="text-indigo-600 hover:text-indigo-800">Download PDF</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
const API = "http://localhost:4000";
const token = localStorage.getItem("token");
if (!token) window.location.href = "teacherloginpage.html";

let students = [];

// Auto-load attendance students
document.addEventListener("DOMContentLoaded", async () => {
  document.getElementById("attendanceDate").valueAsDate = new Date();
  await loadStudents();
});

// ========== ATTENDANCE LOGIC ==========
async function loadStudents() {
  const cls = document.getElementById("classSelect").value;
  const res = await fetch(`${API}/students?className=${encodeURIComponent(cls)}`, {
    headers: { Authorization: `Bearer ${token}` }
  });
  students = await res.json();

  if (!Array.isArray(students) || students.length === 0) {
    alert(`⚠️ No students found for ${cls}. Please add them in Manage Students.`);
    students = [];
  } else {
    students = students.map(s => ({ ...s, present: true, remarks: "" }));
  }

  renderStudentList();
}

function renderStudentList() {
  const tbody = document.getElementById("studentList");
  tbody.innerHTML = students.map(s => `
    <tr>
      <td class="px-6 py-4 text-sm">${s.roll}</td>
      <td class="px-6 py-4 text-sm">${s.name}</td>
      <td class="px-6 py-4">
        <label class="mr-4">
          <input type="radio" name="att_${s._id}" value="present"
                 ${s.present ? "checked" : ""}
                 onchange="setAttendance('${s._id}', true)">
          <span class="text-green-600 font-semibold">Present</span>
        </label>
        <label>
          <input type="radio" name="att_${s._id}" value="absent"
                 ${!s.present ? "checked" : ""}
                 onchange="setAttendance('${s._id}', false)">
          <span class="text-red-600 font-semibold">Absent</span>
        </label>
      </td>
      <td class="px-6 py-4">
        <input type="text" id="remark_${s._id}" value="${s.remarks || ""}"
               class="border rounded px-2 py-1 text-sm w-full"
               placeholder="Optional remarks"
               oninput="setRemark('${s._id}', this.value)">
      </td>
    </tr>
  `).join('');
}

function setAttendance(id, present) {
  const student = students.find(x => x._id === id);
  if (student) student.present = present;
}
function setRemark(id, text) {
  const student = students.find(x => x._id === id);
  if (student) student.remarks = text;
}

function markAllPresent() {
  students.forEach(s => s.present = true);
  renderStudentList();
}
function markAllAbsent() {
  students.forEach(s => s.present = false);
  renderStudentList();
}
function resetAttendance() {
  students.forEach(s => { s.present = true; s.remarks = "" });
  renderStudentList();
}

async function submitAttendance() {
  const cls = document.getElementById("classSelect").value;
  const date = document.getElementById("attendanceDate").value;

  const entries = students.map(s => ({
    studentId: s._id,
    present: s.present,
    remarks: s.remarks || ""
  }));

  const res = await fetch(`${API}/attendance/mark`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${token}`
    },
    body: JSON.stringify({ date, className: cls, entries })
  });

  if (res.ok) {
    alert("✅ Attendance saved successfully!");
  } else {
    const err = await res.json();
    alert("❌ Error: " + err.message);
  }
}

document.getElementById("classSelect").addEventListener("change", loadStudents);

// ========== MANAGE STUDENTS ==========
async function loadAllStudents() {
  const cls = document.getElementById("classSelect").value;
  const res = await fetch(`${API}/students?className=${encodeURIComponent(cls)}`, {
    headers: { Authorization: `Bearer ${token}` }
  });
  const data = await res.json();

  const tbody = document.getElementById("studentManageList");
  tbody.innerHTML = data.map(s => `
    <tr>
      <td class="px-6 py-4 text-sm">${s.roll}</td>
      <td class="px-6 py-4 text-sm">${s.name}</td>
      <td class="px-6 py-4 text-sm">${s.className}</td>
    </tr>
  `).join('');
}

document.getElementById("addStudentForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const roll = document.getElementById("roll").value;
  const name = document.getElementById("name").value;
  const className = document.getElementById("className").value;

  const res = await fetch(`${API}/students`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${token}`
    },
    body: JSON.stringify({ students: [{ roll, name, className }] })
  });

  if (res.ok) {
    alert("✅ Student added!");
    document.getElementById("addStudentForm").reset();
    loadAllStudents();
  } else {
    const err = await res.json();
    alert("❌ Error: " + err.message);
  }
});

function openStudentsTab() {
  switchTab("students");
  loadAllStudents();
}
document.getElementById("studentsTab").setAttribute("onclick", "openStudentsTab()");

// ========== REPORTS ==========
async function generateReport() {
  const cls = document.querySelector('#reportsContent select:nth-of-type(1)').value;
  const type = document.querySelector('#reportsContent select:nth-of-type(2)').value;
  const fromDate = document.querySelector('#reportsContent input:nth-of-type(1)').value;
  const toDate = document.querySelector('#reportsContent input:nth-of-type(2)').value;

  if (cls === "Select Class" || type === "Report Type" || !fromDate || !toDate) {
    alert("⚠️ Please choose class, report type, and date range");
    return;
  }

  const url = `${API}/reports/summary?className=${encodeURIComponent(cls)}&from=${fromDate}&to=${toDate}`;
  const res = await fetch(url, {
    headers: { Authorization: `Bearer ${token}` }
  });

  if (!res.ok) {
    alert("❌ Error generating report");
    return;
  }

  const data = await res.json();

  document.getElementById("avgAttendance").textContent = data.average + "%";
  document.getElementById("perfectAttendance").textContent = data.perfectCount;
  document.getElementById("below75").textContent = data.below75Count;
  document.getElementById("totalDays").textContent = data.days;

  const recentReports = document.querySelector("#reportsContent .space-y-3");
  const now = new Date().toLocaleDateString();
  recentReports.innerHTML = `
    <div class="border border-gray-200 rounded-lg p-4 flex justify-between items-center">
      <div>
        <p class="font-semibold">${cls} - ${type} Report</p>
        <p class="text-sm text-gray-600">Generated on: ${now}</p>
      </div>
      <button onclick="downloadReport('${cls}', '${fromDate}', '${toDate}')"
              class="text-indigo-600 hover:text-indigo-800">Download PDF</button>
    </div>
  `;
}
document.querySelector("#reportsContent button").setAttribute("onclick", "generateReport()");

function downloadReport(cls, fromDate, toDate) {
  alert(`📄 PDF export stub — Class: ${cls}, From: ${fromDate}, To: ${toDate}`);
}
</script>



</body>

</html>